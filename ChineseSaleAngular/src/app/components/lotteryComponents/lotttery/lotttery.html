<div class="lottery-page">
  <h1 class="lottery-title">ğŸ² ×”×’×¨×œ×”</h1>
  
  <div class="export-actions">
    <button
      nz-button
      nzType="default"
      class="export-btn pdf"
      (click)="exportSummary('pdf')"
      [nzLoading]="isExporting"
      [disabled]="isExporting">
      <span nz-icon nzType="file-pdf" nzTheme="outline"></span>
      PDF
    </button>
    <button
      nz-button
      nzType="default"
      class="export-btn csv"
      (click)="exportSummary('csv')"
      [nzLoading]="isExporting"
      [disabled]="isExporting">
      <span nz-icon nzType="file-text" nzTheme="outline"></span>
      CSV
    </button>
    <button
      nz-button
      nzType="default"
      class="export-btn json"
      (click)="exportSummary('json')"
      [nzLoading]="isExporting"
      [disabled]="isExporting">
      <span nz-icon nzType="file-sync" nzTheme="outline"></span>
      JSON
    </button>
  </div>
  </div>
  @if (!canDraw) {
    <nz-result
      nzStatus="info"
      nzTitle="×”×”×’×¨×œ×” ×œ× ×¤×¢×™×œ×” ×›×¨×’×¢"
      nzSubTitle="×”×”×’×¨×œ×” ×˜×¨× ×”×ª×—×™×œ×” ××• ×©×›×‘×¨ ×”×¡×ª×™×™××”">
    </nz-result>
  }

  <div class="gifts-grid">
    @for (gift of allGifts; track gift.id) {
      <div
        class="gift-card-wrapper"
        [class.ready]="getGiftStatus(gift) === 'ready'"
        [class.won]="getGiftStatus(gift) === 'won'"
        [class.no-tickets]="getGiftStatus(gift) === 'no-tickets'"
        [class.disabled]="getGiftStatus(gift) === 'disabled'"
        (click)="onGiftClick(gift)"
      >
        <nz-card [nzCover]="coverTpl" class="gift-card" nzHoverable>
          <nz-card-meta [nzTitle]="gift.name" />

          <div class="gift-info">
            <nz-tag nzColor="blue">ğŸŸï¸ {{ gift.countCards }} ×›×¨×˜×™×¡×™×</nz-tag>

            @if (getGiftStatus(gift) === 'won') {
              <nz-tag nzColor="gold">ğŸ† {{ gift.winner }}</nz-tag>
            }
            @if (getGiftStatus(gift) === 'ready') {
              <nz-tag nzColor="green">×œ×—×¥ ×œ×”×’×¨×œ×”</nz-tag>
            }
            @if (getGiftStatus(gift) === 'no-tickets') {
              <nz-tag nzColor="red">××™×Ÿ ×›×¨×˜×™×¡×™×</nz-tag>
            }
            @if (getGiftStatus(gift) === 'disabled') {
              <nz-tag nzColor="default">×”×”×’×¨×œ×” ×œ× ×¤×¢×™×œ×”</nz-tag>
            }
          </div>
        </nz-card>

        <ng-template #coverTpl>
          <div class="card-cover">
            <img [src]="environment.baseImageUrl + '/' + gift.imageUrl" [alt]="gift.name" />
            @if (getGiftStatus(gift) === 'won') {
              <div class="won-overlay">
                <span nz-icon nzType="trophy" nzTheme="twotone" [nzTwotoneColor]="'#faad14'" class="trophy-icon"></span>
              </div>
            }
          </div>
        </ng-template>
      </div>
    }
  </div>

  <!-- Pagination -->
  <nz-pagination
    class="lottery-pagination"
    [nzPageIndex]="pageNumber"
    [nzTotal]="total || 0"
    [nzPageSize]="pageSize"
    (nzPageIndexChange)="onPageChange($event)">
  </nz-pagination>

  <!-- MODAL 1: Confirmation -->
  <nz-modal
    [(nzVisible)]="showConfirmModal"
    nzTitle="××™×©×•×¨ ×”×’×¨×œ×”"
    nzOkText="ğŸ² ×”×ª×—×œ ×”×’×¨×œ×”"
    nzCancelText="×‘×™×˜×•×œ"
    (nzOnOk)="onConfirmDraw()"
    (nzOnCancel)="onCancelDraw()"
    [nzWidth]="420"
    nzCentered>
    @if (selectedGift) {
      <div class="confirm-content" *nzModalContent>
        <div class="confirm-gift-name">{{ selectedGift.name }}</div>
        <div class="confirm-tickets">ğŸŸï¸ {{ selectedGift.countCards }} ×›×¨×˜×™×¡×™× ××©×ª×ª×¤×™×</div>
        <p class="confirm-question">×”×× ×œ×‘×¦×¢ ××ª ×”×”×’×¨×œ×” ×¢×›×©×™×•?</p>
      </div>
    }
  </nz-modal>

  <!-- MODAL 2: Countdown -->
  <nz-modal
    [(nzVisible)]="showCountdownModal"
    [nzClosable]="false"
    [nzFooter]="null"
    [nzWidth]="360"
    nzCentered>
    <div class="countdown-content" *nzModalContent>
      @if (isDrawing) {
        <nz-spin nzSize="large" nzTip="××’×¨×™×œ..."></nz-spin>
      } @else {
        <div class="countdown-number">{{ countdownValue }}</div>
        <div class="countdown-label">×”×”×’×¨×œ×” ××ª×—×™×œ×”...</div>
        <div class="countdown-gift-name">{{ selectedGift?.name }}</div>
      }
    </div>
  </nz-modal>

  <!-- MODAL 3: Winner -->
  <nz-modal
    [(nzVisible)]="showWinnerModal"
    [nzFooter]="winnerFooter"
    [nzWidth]="480"
    nzCentered
    [nzClosable]="true"
    (nzOnCancel)="closeWinnerModal()">
    <div class="winner-content" *nzModalContent>
      <div class="winner-celebration">ğŸ‰</div>
      <div class="winner-title">!×”×–×•×›×” ×”×’×“×•×œ</div>
      <div class="winner-gift">{{ selectedGift?.name }}</div>
      <div class="winner-name">{{ winnerName }}</div>
      <div class="winner-confetti">ğŸŠâœ¨ğŸŠ</div>
    </div>
    <ng-template #winnerFooter>
      <button nz-button nzType="primary" nzSize="large" (click)="closeWinnerModal()">
        ×¡×’×•×¨
      </button>
    </ng-template>
  </nz-modal>
